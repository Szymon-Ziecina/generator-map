(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var o=t.g.document;if(!e&&o&&(o.currentScript&&"SCRIPT"===o.currentScript.tagName.toUpperCase()&&(e=o.currentScript.src),!e)){var s=o.getElementsByTagName("script");if(s.length)for(var i=s.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=s[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();const e=t.p+"assets/sprites.png";var o=new(function(){function t(){this.map=document.querySelector("#map"),this.mapColsCount=100,this.mapRowsCount=50,this.sprites=e,this.spritesColsCount=16,this.spritesRowsCount=40,this.spriteBorderSize=1,this.spriteSize=47,this.board=document.querySelector("#sprites"),this.selectIndicator=document.querySelector("#select-indicator"),this.selectedTiles=[],this.mouseDown=!1,this.ctrlDown=!1,this.mousePosition={x:0,y:0},this.dragStartPosition=null,this.dragEndPosition=null,this.autoCheckbox=document.querySelector("#auto-checkbox"),this.isAutoEnabled=!1,this.initBoard(),this.bindEvents()}return t.prototype.initBoard=function(){for(var t=this,e=0;e<this.spritesRowsCount;e++)for(var o=function(o){var i=document.createElement("div"),n="-".concat(s.spriteBorderSize*(o+1)+s.spriteSize*o,"px -").concat(s.spriteBorderSize*(e+1)+s.spriteSize*e,"px");i.classList.add("sprite"),i.style.background="url(".concat(s.sprites,")"),i.style.backgroundPosition=n,i.onclick=function(){t.drawMap(n)},s.board.appendChild(i)},s=this,i=0;i<this.spritesColsCount;i++)o(i);this.map.style.gridTemplateColumns="repeat(".concat(this.mapColsCount,", 1fr)"),this.map.style.gridTemplateRows="repeat(".concat(this.mapRowsCount,", 1fr)");for(e=0;e<this.mapRowsCount;e++)for(i=0;i<this.mapColsCount;i++){var n=document.createElement("div");n.classList.add("tile"),n.setAttribute("data-col",i.toString()),n.setAttribute("data-row",e.toString()),this.map.appendChild(n)}},t.prototype.bindEvents=function(){var t=this;this.map.addEventListener("mousemove",(function(e){var o=t.map.getBoundingClientRect();if(t.mousePosition={x:e.clientX-o.left,y:e.clientY-o.top},t.mouseDown){var s=Math.min(t.dragStartPosition.x,t.mousePosition.x),i=Math.min(t.dragStartPosition.y,t.mousePosition.y),n=Math.abs(t.mousePosition.x-t.dragStartPosition.x),r=Math.abs(t.mousePosition.y-t.dragStartPosition.y);t.selectIndicator.style.left="".concat(s,"px"),t.selectIndicator.style.top="".concat(i,"px"),t.selectIndicator.style.width="".concat(n,"px"),t.selectIndicator.style.height="".concat(r,"px"),t.selectIndicator.style.display="block",t.selectTiles(!0)}})),this.map.addEventListener("mousedown",(function(){document.querySelectorAll(".selected").forEach((function(e){!t.selectedTiles.includes(e)&&e.classList.contains("selected")&&e.classList.remove("selected")})),t.ctrlDown||(t.selectedTiles=[]),t.dragStartPosition=t.mousePosition,t.mouseDown=!0})),this.map.addEventListener("mouseup",(function(){t.dragEndPosition=t.mousePosition,t.mouseDown=!1,t.selectIndicator.style.display="none",t.selectTiles()})),this.autoCheckbox.addEventListener("change",(function(){t.isAutoEnabled=t.autoCheckbox.checked})),document.body.addEventListener("keydown",(function(e){console.log(e.key),"Delete"==e.key?(t.selectedTiles.forEach((function(t){t.style.background="transparent",t.classList.remove("selected")})),t.selectedTiles=[]):(e.metaKey||e.ctrlKey)&&(t.ctrlDown=!0)})),document.body.addEventListener("keyup",(function(e){e.metaKey&&e.ctrlKey||(t.ctrlDown=!1,console.log("keyup"))}))},t.prototype.selectTiles=function(t){var e=this;if(t&&(this.dragEndPosition=this.mousePosition),this.dragStartPosition&&this.dragEndPosition){this.ctrlDown||(this.selectedTiles=[]);var o=Math.min(this.dragStartPosition.x,this.dragEndPosition.x),s=Math.max(this.dragStartPosition.x,this.dragEndPosition.x),i=Math.min(this.dragStartPosition.y,this.dragEndPosition.y),n=Math.max(this.dragStartPosition.y,this.dragEndPosition.y);this.map.querySelectorAll(".tile").forEach((function(r){var a=r.getBoundingClientRect(),c=e.map.getBoundingClientRect(),l=a.left-c.left,d=a.right-c.left,u=a.top-c.top,p=a.bottom-c.top;!e.selectedTiles.includes(r)&&r.classList.contains("selected")&&r.classList.remove("selected"),l<s&&d>o&&u<n&&p>i&&(r.classList.add("selected"),t||e.selectedTiles.push(r))}))}},t.prototype.drawMap=function(t){var e=this;this.selectedTiles.length<=0||(this.selectedTiles.forEach((function(o){o.style.background="url(".concat(e.sprites,")"),o.style.backgroundPosition=t,o.classList.remove("selected")})),this.isAutoEnabled?this.selectNextTile():this.selectedTiles=[])},t.prototype.selectNextTile=function(){var t,e=this.selectedTiles[this.selectedTiles.length-1],o={col:parseInt(e.getAttribute("data-col")),row:parseInt(e.getAttribute("data-row"))};t=o.col>=this.mapColsCount-1?document.querySelector('div[data-col="0"][data-row="'.concat(o.row+1,'"]')):document.querySelector('div[data-col="'.concat(o.col+1,'"][data-row="').concat(o.row,'"]')),this.selectedTiles=[],o.col>=this.mapColsCount-1&&o.row>=this.mapRowsCount-1||(t.classList.add("selected"),this.selectedTiles.push(t))},t.prototype.saveToFile=function(){var t=JSON.stringify(this.createMapJSON()),e=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(e),s=document.createElement("a");s.style.display="hidden",s.href=o,s.download="Mapa.json",s.click(),URL.revokeObjectURL(o)},t.prototype.createMapJSON=function(){var t=Array.from(document.querySelectorAll(".tile")),e=[];return t.forEach((function(t,o){var s=window.getComputedStyle(t),i=t.getAttribute("data-col"),n=t.getAttribute("data-row");e.push({id:o,bgPosition:s.backgroundPosition,col:i,row:n})})),e},t}());window.map=o})();